parents:
  - aws-cenv-db

  - module: cluster
    profile: aws-cenv

  - aws-config

provision:
  cenv-app-environment:
    module: cluster
    scopes:
      network: "@aws_networks"
    servers:
      - subnet.network.name=<network>
      - groups.name=cenv
    env:
      CENV_MYSQL_HOST: "&load_balancer(network=<network>):percona-db:variables[lb_dns_name]"
      CENV_MYSQL_PORT: 3306
      CENV_MYSQL_DB: "@cenv_database"
      CENV_MYSQL_USER: "@cenv_database"
      CENV_MYSQL_PASSWORD: "@cenv_password"
